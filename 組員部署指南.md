# YOLOv11數位雙生分析系統 - 組員部署指南

## 🚀 快速開始

您有兩種方式部署這個系統：

### 方式1：完整自動部署（推薦）
```bash
python deploy.py
```
這個腳本會自動完成所有設置，包括環境檢查、依賴安裝、資料庫創建等。

### 方式2：僅設置資料庫
```bash  
python quick_database_setup.py
```
如果您只需要快速創建資料庫，使用這個腳本。

## 📋 系統需求

### 必要軟體
- **Python 3.8+** (推薦 3.10+)
- **Node.js 16+** (包含 npm)
- **PostgreSQL 12+** (必須已安裝並運行)

### 硬體建議
- RAM: 8GB+ (推薦 16GB+)
- 硬碟: 10GB+ 可用空間
- CPU: 4核心+ (用於YOLO推理)
- GPU: NVIDIA顯卡 (可選，加速推理)

## 🗄️ 資料庫配置

### 預設設定
- **主機**: localhost
- **端口**: 5432  
- **用戶**: postgres
- **密碼**: 49679904 (可在腳本中修改)
- **資料庫名**: yolo_analysis

### 如何修改密碼
1. 編輯 `deploy.py` 或 `quick_database_setup.py`
2. 找到 `self.db_config["password"]`
3. 改為您的PostgreSQL密碼

## 📁 部署後的目錄結構

```
system/
├── yolo_backend/           # Python後端
├── react web/             # React前端  
├── models/                # YOLO模型檔案
├── uploads/               # 上傳檔案
├── logs/                  # 系統日誌
├── .env                   # 環境變數
├── database_info.json     # 資料庫資訊
├── 啟動系統.bat           # Windows啟動腳本
├── start_system.sh        # Linux/Mac啟動腳本
└── 部署說明.md            # 使用說明
```

## 🔧 部署步驟詳解

### 完整部署 (deploy.py)

1. **環境檢查** - 檢查Python, Node.js, PostgreSQL
2. **依賴安裝** - 安裝Python套件和npm套件
3. **資料庫創建** - 創建yolo_analysis資料庫
4. **表格初始化** - 創建所有必要的資料表
5. **環境配置** - 生成.env檔案
6. **範例資料** - 創建範例攝影機配置
7. **模型下載** - 下載YOLO11n模型
8. **系統測試** - 驗證所有組件正常
9. **啟動腳本** - 創建便捷啟動方式

### 快速資料庫設置 (quick_database_setup.py)

1. **套件安裝** - 安裝psycopg2和SQLAlchemy
2. **連接測試** - 測試PostgreSQL連接  
3. **資料庫創建** - 創建yolo_analysis資料庫
4. **表格創建** - 創建6個核心資料表
5. **範例資料** - 插入基本配置和範例資料
6. **設置驗證** - 檢查所有表格和約束
7. **資訊保存** - 生成連接資訊檔案

## 🌐 系統訪問

部署完成後，您可以訪問：

- **前端界面**: http://localhost:3000
- **API文檔**: http://localhost:8001/docs  
- **後端健康檢查**: http://localhost:8001/api/v1/health
- **系統狀態**: http://localhost:8001/api/v1/frontend/stats

## 🎮 啟動系統

### Windows用戶
雙擊 `啟動系統.bat` 或執行：
```cmd
python start.py
```

### Linux/Mac用戶  
執行：
```bash
./start_system.sh
# 或
python3 start.py
```

## 📊 資料庫表格說明

### 核心表格
1. **analysis_tasks** - 分析任務管理
2. **detection_results** - 物件檢測結果  
3. **behavior_events** - 行為事件記錄
4. **data_sources** - 攝影機和影片來源
5. **users** - 使用者管理
6. **system_config** - 系統配置

### 關聯關係
- `detection_results.task_id` → `analysis_tasks.id`
- `behavior_events.task_id` → `analysis_tasks.id`

## 🔍 故障排除

### 常見問題

#### 1. PostgreSQL連接失敗
```
❌ PostgreSQL連接失敗: could not connect to server
```
**解決方案:**
- 確認PostgreSQL服務正在運行
- 檢查防火牆設定
- 驗證用戶名密碼是否正確

#### 2. 端口被占用
```
❌ [Errno 10048] Only one usage of each socket address
```
**解決方案:**
- 檢查8001和3000端口是否被占用
- 關閉其他使用這些端口的應用程式

#### 3. Python套件安裝失敗
```
❌ Python套件安裝失敗
```
**解決方案:**
```bash
# 升級pip
python -m pip install --upgrade pip

# 清除快取後重新安裝
python -m pip cache purge
python -m pip install -r requirements.txt
```

#### 4. Node.js套件安裝失敗
```
❌ Node.js套件安裝失敗
```
**解決方案:**
```bash
# 清除npm快取
npm cache clean --force

# 刪除node_modules後重新安裝
rm -rf "react web/node_modules"
cd "react web"
npm install
```

### 手動驗證步驟

#### 檢查PostgreSQL
```bash
# Windows
net start postgresql-x64-14

# Linux/Mac  
sudo systemctl start postgresql
sudo systemctl status postgresql
```

#### 檢查資料庫
```sql
-- 連接到PostgreSQL
psql -U postgres -h localhost

-- 檢查資料庫
\l

-- 連接到yolo_analysis
\c yolo_analysis

-- 檢查表格
\dt
```

#### 檢查Python環境
```bash
python --version
python -c "import psycopg2; print('psycopg2 OK')"
python -c "import sqlalchemy; print('SQLAlchemy OK')"
```

#### 檢查Node.js環境  
```bash
node --version
npm --version
```

## 📞 技術支援

### 日誌檔案位置
- 系統日誌: `logs/system.log`
- 資料庫日誌: `logs/database.log`
- API日誌: `logs/api.log`

### 配置檔案
- 環境變數: `.env`
- 資料庫資訊: `database_info.json`
- 攝影機配置: `camera1.json`, `camera2.json`, `camera3.json`

### 聯絡資訊
如遇到無法解決的問題，請提供：
1. 錯誤訊息截圖
2. 系統環境資訊 (OS, Python版本等)
3. 日誌檔案內容
4. 執行的具體步驟

---

## 🎯 部署檢查清單

- [ ] Python 3.8+ 已安裝
- [ ] Node.js 16+ 已安裝  
- [ ] PostgreSQL 已安裝並運行
- [ ] 執行 `python deploy.py` 成功
- [ ] 資料庫表格創建完成
- [ ] 系統啟動成功 (`python start.py`)
- [ ] 前端可訪問 (http://localhost:3000)
- [ ] API可訪問 (http://localhost:8001/docs)
- [ ] 攝影機配置檔案已創建
- [ ] 環境變數檔案已生成

**恭喜！🎉 您的YOLOv11數位雙生分析系統已成功部署！**