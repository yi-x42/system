# YOLOv11 æ•¸ä½é›™ç”Ÿåˆ†æç³»çµ± - è³‡æ–™åº«çµæ§‹èªªæ˜

## ğŸ“Š è³‡æ–™åº«æ¦‚è¦½
- **è³‡æ–™åº«åç¨±**: `yolo_analysis`
- **è³‡æ–™åº«é¡å‹**: PostgreSQL
- **é€£æ¥è³‡è¨Š**: `localhost:5432`
- **ç”¨æˆ¶**: `postgres`

---

## ğŸ“‹ è³‡æ–™è¡¨çµæ§‹è©³ç´°èªªæ˜

### 1. ğŸ—‚ï¸ **åˆ†æè¨˜éŒ„è¡¨** (`analysis_records`)
ç”¨æ–¼å„²å­˜æ¯æ¬¡å½±ç‰‡åˆ†æçš„åŸºæœ¬è³‡è¨Šå’Œçµ±è¨ˆçµæœ

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | æ˜¯å¦å¿…å¡« | ä¸­æ–‡èªªæ˜ | è‹±æ–‡èªªæ˜ |
|---------|----------|----------|----------|----------|
| `id` | Integer | âœ… | ä¸»éµID | Primary Key |
| `created_at` | DateTime | âœ… | å»ºç«‹æ™‚é–“ | Creation timestamp |
| `updated_at` | DateTime | âŒ | æ›´æ–°æ™‚é–“ | Last update timestamp |
| `video_path` | String(500) | âœ… | å½±ç‰‡æª”æ¡ˆè·¯å¾‘ | Video file path |
| `video_name` | String(255) | âœ… | å½±ç‰‡æª”æ¡ˆåç¨± | Video file name |
| `analysis_type` | String(50) | âœ… | åˆ†æé¡å‹ | Analysis type (detection/annotation) |
| `status` | String(50) | âœ… | è™•ç†ç‹€æ…‹ | Processing status |
| `duration` | Float | âŒ | å½±ç‰‡é•·åº¦(ç§’) | Video duration in seconds |
| `fps` | Float | âŒ | å¹€ç‡ | Frames per second |
| `total_frames` | Integer | âŒ | ç¸½å¹€æ•¸ | Total frame count |
| `resolution` | String(50) | âŒ | è§£æåº¦ | Video resolution |
| `total_detections` | Integer | âœ… | ç¸½æª¢æ¸¬æ•¸é‡ | Total detection count |
| `unique_objects` | Integer | âœ… | å”¯ä¸€ç‰©ä»¶æ•¸é‡ | Unique object count |
| `analysis_duration` | Float | âŒ | åˆ†æè€—æ™‚(ç§’) | Analysis processing time |
| `csv_file_path` | String(500) | âŒ | CSVçµæœæª”æ¡ˆè·¯å¾‘ | CSV result file path |
| `annotated_video_path` | String(500) | âŒ | æ¨™è¨»å½±ç‰‡æª”æ¡ˆè·¯å¾‘ | Annotated video file path |
| `extra_data` | JSON | âŒ | é¡å¤–å…ƒæ•¸æ“š | Additional metadata |
| `error_message` | Text | âŒ | éŒ¯èª¤è¨Šæ¯ | Error message if any |

**ç‹€æ…‹å€¼èªªæ˜** (`status`):
- `processing` - è™•ç†ä¸­
- `completed` - å·²å®Œæˆ
- `failed` - è™•ç†å¤±æ•—

---

### 2. ğŸ” **æª¢æ¸¬çµæœè¡¨** (`detection_results`)
ç”¨æ–¼å„²å­˜æ¯å€‹æª¢æ¸¬åˆ°çš„ç‰©ä»¶è©³ç´°è³‡è¨Š

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | æ˜¯å¦å¿…å¡« | ä¸­æ–‡èªªæ˜ | è‹±æ–‡èªªæ˜ |
|---------|----------|----------|----------|----------|
| `id` | Integer | âœ… | ä¸»éµID | Primary Key |
| `created_at` | DateTime | âœ… | å»ºç«‹æ™‚é–“ | Creation timestamp |
| `updated_at` | DateTime | âŒ | æ›´æ–°æ™‚é–“ | Last update timestamp |
| `analysis_id` | Integer | âœ… | é—œè¯åˆ†æè¨˜éŒ„ID | Related analysis record ID |
| `timestamp` | DateTime | âœ… | æª¢æ¸¬æ™‚é–“ | Detection timestamp |
| `frame_number` | Integer | âœ… | å¹€ç·¨è™Ÿ | Frame number |
| `frame_time` | Float | âœ… | å½±ç‰‡æ™‚é–“é»(ç§’) | Video time position |
| `object_id` | String(100) | âŒ | ç‰©ä»¶è¿½è¹¤ID | Object tracking ID |
| `object_type` | String(50) | âœ… | ç‰©ä»¶é¡å‹ | Object type (person/car/etc) |
| `object_chinese` | String(50) | âŒ | ç‰©ä»¶ä¸­æ–‡åç¨± | Chinese name of object |
| `confidence` | Float | âœ… | ä¿¡å¿ƒåº¦ | Detection confidence score |
| `bbox_x1` | Float | âœ… | é‚Šç•Œæ¡†å·¦ä¸ŠXåº§æ¨™ | Bounding box top-left X |
| `bbox_y1` | Float | âœ… | é‚Šç•Œæ¡†å·¦ä¸ŠYåº§æ¨™ | Bounding box top-left Y |
| `bbox_x2` | Float | âœ… | é‚Šç•Œæ¡†å³ä¸‹Xåº§æ¨™ | Bounding box bottom-right X |
| `bbox_y2` | Float | âœ… | é‚Šç•Œæ¡†å³ä¸‹Yåº§æ¨™ | Bounding box bottom-right Y |
| `center_x` | Float | âœ… | ç‰©ä»¶ä¸­å¿ƒXåº§æ¨™ | Object center X coordinate |
| `center_y` | Float | âœ… | ç‰©ä»¶ä¸­å¿ƒYåº§æ¨™ | Object center Y coordinate |
| `width` | Float | âœ… | ç‰©ä»¶å¯¬åº¦ | Object width |
| `height` | Float | âœ… | ç‰©ä»¶é«˜åº¦ | Object height |
| `area` | Float | âœ… | ç‰©ä»¶é¢ç© | Object area |
| `zone` | String(50) | âŒ | æª¢æ¸¬å€åŸŸ | Detection zone |
| `zone_chinese` | String(50) | âŒ | å€åŸŸä¸­æ–‡åç¨± | Chinese zone name |
| `velocity_x` | Float | âŒ | Xæ–¹å‘é€Ÿåº¦ | Velocity in X direction |
| `velocity_y` | Float | âŒ | Yæ–¹å‘é€Ÿåº¦ | Velocity in Y direction |
| `direction_angle` | Float | âŒ | ç§»å‹•æ–¹å‘è§’åº¦ | Movement direction angle |
| `direction_chinese` | String(20) | âŒ | ç§»å‹•æ–¹å‘ä¸­æ–‡ | Chinese direction name |
| `detection_quality` | String(20) | âŒ | æª¢æ¸¬å“è³ªè©•ä¼° | Detection quality assessment |

**å¸¸è¦‹ç‰©ä»¶é¡å‹** (`object_type`):
- `person` - äºº (`object_chinese`: äºº)
- `car` - æ±½è»Š (`object_chinese`: æ±½è»Š)
- `truck` - å¡è»Š (`object_chinese`: å¡è»Š)
- `bus` - å·´å£« (`object_chinese`: å·´å£«)
- `bicycle` - è…³è¸è»Š (`object_chinese`: è…³è¸è»Š)
- `motorcycle` - æ©Ÿè»Š (`object_chinese`: æ©Ÿè»Š)

**å€åŸŸé¡å‹** (`zone`):
- `center` - ä¸­å¤®å€åŸŸ (`zone_chinese`: ä¸­å¤®å€åŸŸ)
- `left` - å·¦å´å€åŸŸ (`zone_chinese`: å·¦å´å€åŸŸ)
- `right` - å³å´å€åŸŸ (`zone_chinese`: å³å´å€åŸŸ)
- `top` - ä¸Šæ–¹å€åŸŸ (`zone_chinese`: ä¸Šæ–¹å€åŸŸ)
- `bottom` - ä¸‹æ–¹å€åŸŸ (`zone_chinese`: ä¸‹æ–¹å€åŸŸ)

---

### 3. ğŸ¯ **è¡Œç‚ºäº‹ä»¶è¡¨** (`behavior_events`)
ç”¨æ–¼å„²å­˜æª¢æ¸¬åˆ°çš„è¡Œç‚ºäº‹ä»¶å’Œç•°å¸¸ç‹€æ³

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | æ˜¯å¦å¿…å¡« | ä¸­æ–‡èªªæ˜ | è‹±æ–‡èªªæ˜ |
|---------|----------|----------|----------|----------|
| `id` | Integer | âœ… | ä¸»éµID | Primary Key |
| `created_at` | DateTime | âœ… | å»ºç«‹æ™‚é–“ | Creation timestamp |
| `updated_at` | DateTime | âŒ | æ›´æ–°æ™‚é–“ | Last update timestamp |
| `analysis_id` | Integer | âœ… | é—œè¯åˆ†æè¨˜éŒ„ID | Related analysis record ID |
| `timestamp` | DateTime | âœ… | äº‹ä»¶ç™¼ç”Ÿæ™‚é–“ | Event timestamp |
| `event_type` | String(50) | âœ… | äº‹ä»¶é¡å‹ | Event type |
| `event_chinese` | String(50) | âŒ | äº‹ä»¶ä¸­æ–‡åç¨± | Chinese event name |
| `object_type` | String(50) | âœ… | ç›¸é—œç‰©ä»¶é¡å‹ | Related object type |
| `object_chinese` | String(50) | âŒ | ç‰©ä»¶ä¸­æ–‡åç¨± | Chinese object name |
| `object_id` | String(100) | âŒ | ç‰©ä»¶è¿½è¹¤ID | Object tracking ID |
| `confidence` | Float | âœ… | äº‹ä»¶ä¿¡å¿ƒåº¦ | Event confidence score |
| `duration` | Float | âŒ | äº‹ä»¶æŒçºŒæ™‚é–“(ç§’) | Event duration in seconds |
| `severity` | String(20) | âŒ | åš´é‡ç¨‹åº¦ | Severity level |
| `description` | Text | âŒ | äº‹ä»¶æè¿° | Event description |
| `zone` | String(50) | âŒ | ç™¼ç”Ÿå€åŸŸ | Event zone |
| `zone_chinese` | String(50) | âŒ | å€åŸŸä¸­æ–‡åç¨± | Chinese zone name |
| `additional_data` | JSON | âŒ | é¡å¤–äº‹ä»¶è³‡æ–™ | Additional event data |

**è¡Œç‚ºäº‹ä»¶é¡å‹** (`event_type`):
- `movement` - ç§»å‹• (`event_chinese`: ç§»å‹•)
- `stop` - åœæ­¢ (`event_chinese`: åœæ­¢)
- `enter_zone` - é€²å…¥å€åŸŸ (`event_chinese`: é€²å…¥å€åŸŸ)
- `exit_zone` - é›¢é–‹å€åŸŸ (`event_chinese`: é›¢é–‹å€åŸŸ)
- `crowding` - èšé›† (`event_chinese`: èšé›†)
- `speeding` - å¿«é€Ÿç§»å‹• (`event_chinese`: å¿«é€Ÿç§»å‹•)
- `loitering` - å¾˜å¾Š (`event_chinese`: å¾˜å¾Š)

**åš´é‡ç¨‹åº¦** (`severity`):
- `low` - ä½ (ä¸€èˆ¬äº‹ä»¶)
- `medium` - ä¸­ (éœ€è¦æ³¨æ„)
- `high` - é«˜ (éœ€è¦ç«‹å³è™•ç†)

---

## ğŸ”— **è³‡æ–™è¡¨é—œè¯åœ–**

```
analysis_records (åˆ†æè¨˜éŒ„)
    â”‚
    â”œâ”€â†’ detection_results (æª¢æ¸¬çµæœ)
    â”‚   âˆŸ ä¸€å°å¤šé—œè¯ (analysis_id)
    â”‚
    â””â”€â†’ behavior_events (è¡Œç‚ºäº‹ä»¶)
        âˆŸ ä¸€å°å¤šé—œè¯ (analysis_id)
```

---

## ğŸ“ **å¸¸ç”¨æŸ¥è©¢ç¯„ä¾‹**

### 1. æŸ¥çœ‹æœ€è¿‘çš„åˆ†æè¨˜éŒ„
```sql
SELECT id, video_name, analysis_type, status, total_detections, created_at 
FROM analysis_records 
ORDER BY created_at DESC 
LIMIT 10;
```

### 2. æŸ¥çœ‹ç‰¹å®šåˆ†æçš„æª¢æ¸¬çµæœ
```sql
SELECT object_chinese, confidence, center_x, center_y 
FROM detection_results 
WHERE analysis_id = 1 
ORDER BY confidence DESC;
```

### 3. çµ±è¨ˆå„ç‰©ä»¶é¡å‹çš„æª¢æ¸¬æ•¸é‡
```sql
SELECT object_chinese, COUNT(*) as count 
FROM detection_results 
GROUP BY object_chinese 
ORDER BY count DESC;
```

### 4. æŸ¥çœ‹é«˜ä¿¡å¿ƒåº¦çš„æª¢æ¸¬çµæœ
```sql
SELECT ar.video_name, dr.object_chinese, dr.confidence 
FROM analysis_records ar 
JOIN detection_results dr ON ar.id = dr.analysis_id 
WHERE dr.confidence > 0.8;
```

### 5. æŸ¥çœ‹è¡Œç‚ºäº‹ä»¶çµ±è¨ˆ
```sql
SELECT event_chinese, COUNT(*) as count 
FROM behavior_events 
GROUP BY event_chinese 
ORDER BY count DESC;
```

---

## ğŸ› ï¸ **è³‡æ–™åº«ç®¡ç†å·¥å…·**

### **é€£æ¥è³‡è¨Š**
- **ä¸»æ©Ÿ**: localhost
- **ç«¯å£**: 5432
- **è³‡æ–™åº«**: yolo_analysis
- **ç”¨æˆ¶å**: postgres
- **å¯†ç¢¼**: 49679904

### **æ¨è–¦å·¥å…·**
1. **pgAdmin** - åœ–å½¢åŒ–ç®¡ç†ä»‹é¢
2. **psql** - å‘½ä»¤åˆ—å·¥å…·
3. **DBeaver** - è·¨å¹³å°è³‡æ–™åº«å·¥å…·

### **Python æŸ¥çœ‹è…³æœ¬**
```bash
# ä½¿ç”¨å°ˆæ¡ˆå…§å»ºçš„è¨ºæ–·è…³æœ¬
python diagnose_db.py
```

---

## ğŸ“Š **API ç«¯é»å°ç…§**

| API ç«¯é» | åŠŸèƒ½ | ç›¸é—œè³‡æ–™è¡¨ |
|---------|------|-----------|
| `POST /api/v1/analysis/upload-with-database` | ä¸Šå‚³å½±ç‰‡åˆ†æ | æ‰€æœ‰è¡¨æ ¼ |
| `GET /api/v1/analysis/history` | ç²å–åˆ†ææ­·å² | analysis_records |
| `GET /api/v1/analysis/{id}` | ç²å–ç‰¹å®šåˆ†æè©³æƒ… | æ‰€æœ‰è¡¨æ ¼ |
| `GET /api/v1/analysis/statistics` | ç²å–çµ±è¨ˆè³‡è¨Š | æ‰€æœ‰è¡¨æ ¼ |

---

## ğŸ” **æ•…éšœæ’é™¤**

### å¸¸è¦‹å•é¡Œ
1. **æª¢æ¸¬çµæœç‚ºç©º**: æª¢æŸ¥ `total_detections` æ¬„ä½æ˜¯å¦ç‚º 0
2. **å½±ç‰‡åˆ†æå¤±æ•—**: æŸ¥çœ‹ `error_message` æ¬„ä½
3. **è³‡æ–™åº«é€£æ¥å•é¡Œ**: ç¢ºèª PostgreSQL æœå‹™æ˜¯å¦é‹è¡Œ

### è¯çµ¡è³‡è¨Š
- **é–‹ç™¼è€…**: [æ‚¨çš„å§“å]
- **å°ˆæ¡ˆä½ç½®**: `d:\project\system\yolo_backend\`
- **æœ€å¾Œæ›´æ–°**: 2025å¹´7æœˆ20æ—¥

---

*æ­¤æ–‡ä»¶ç”± YOLOv11 æ•¸ä½é›™ç”Ÿåˆ†æç³»çµ±è‡ªå‹•ç”Ÿæˆ*
