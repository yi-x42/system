<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡æ–™åº«æŸ¥è©¢ API æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .filter-input {
            padding: 5px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .loading {
            color: #007bff;
        }
        .error {
            color: #dc3545;
        }
        .success {
            color: #28a745;
        }
        h1, h2 {
            color: #333;
        }
        .filter-section {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š YOLOv11 è³‡æ–™åº«æŸ¥è©¢ API æ¸¬è©¦</h1>
    
    <!-- çµ±è¨ˆè³‡è¨Š -->
    <div class="container">
        <h2>ğŸ“ˆ è³‡æ–™åº«çµ±è¨ˆè³‡è¨Š</h2>
        <button class="button" onclick="getStats()">å–å¾—çµ±è¨ˆè³‡è¨Š</button>
        <div id="statsResult" class="result" style="display:none;"></div>
    </div>
    
    <!-- åˆ†æä»»å‹™æŸ¥è©¢ -->
    <div class="container">
        <h2>ğŸ“‹ åˆ†æä»»å‹™è¡¨æŸ¥è©¢</h2>
        <div class="filter-section">
            <label>æ¯é ç­†æ•¸: <input type="number" id="taskLimit" class="filter-input" value="20" min="1" max="200"></label>
            <label>åç§»é‡: <input type="number" id="taskOffset" class="filter-input" value="0" min="0"></label>
            <label>ä»»å‹™é¡å‹: 
                <select id="taskType" class="filter-input">
                    <option value="">å…¨éƒ¨</option>
                    <option value="realtime_camera">å³æ™‚æ”å½±æ©Ÿ</option>
                    <option value="video_file">å½±ç‰‡æª”æ¡ˆ</option>
                </select>
            </label>
            <label>ç‹€æ…‹: 
                <select id="taskStatus" class="filter-input">
                    <option value="">å…¨éƒ¨</option>
                    <option value="pending">ç­‰å¾…ä¸­</option>
                    <option value="running">åŸ·è¡Œä¸­</option>
                    <option value="completed">å·²å®Œæˆ</option>
                    <option value="failed">å¤±æ•—</option>
                </select>
            </label>
        </div>
        <button class="button" onclick="getTasks()">æŸ¥è©¢åˆ†æä»»å‹™</button>
        <div id="tasksResult" class="result" style="display:none;"></div>
    </div>
    
    <!-- æª¢æ¸¬çµæœæŸ¥è©¢ -->
    <div class="container">
        <h2>ğŸ¯ æª¢æ¸¬çµæœè¡¨æŸ¥è©¢</h2>
        <div class="filter-section">
            <label>æ¯é ç­†æ•¸: <input type="number" id="detectionLimit" class="filter-input" value="50" min="1" max="500"></label>
            <label>åç§»é‡: <input type="number" id="detectionOffset" class="filter-input" value="0" min="0"></label>
            <label>ä»»å‹™ID: <input type="number" id="detectionTaskId" class="filter-input" placeholder="ç‰¹å®šä»»å‹™ID"></label>
            <label>ç‰©ä»¶é¡å‹: <input type="text" id="detectionObjectType" class="filter-input" placeholder="person, car, bike..."></label>
            <label>æœ€å°ä¿¡å¿ƒåº¦: <input type="number" id="detectionMinConf" class="filter-input" step="0.1" min="0" max="1" placeholder="0.0-1.0"></label>
        </div>
        <button class="button" onclick="getDetections()">æŸ¥è©¢æª¢æ¸¬çµæœ</button>
        <div id="detectionsResult" class="result" style="display:none;"></div>
    </div>
    
    <!-- ä»»å‹™è©³æƒ…æŸ¥è©¢ -->
    <div class="container">
        <h2>ğŸ” ä»»å‹™è©³æƒ…æŸ¥è©¢</h2>
        <div class="filter-section">
            <label>ä»»å‹™ID: <input type="number" id="taskDetailId" class="filter-input" placeholder="è¼¸å…¥ä»»å‹™ID"></label>
            <label><input type="checkbox" id="includeDetections"> åŒ…å«æª¢æ¸¬çµæœ</label>
            <label>æª¢æ¸¬çµæœé™åˆ¶: <input type="number" id="detectionDetailLimit" class="filter-input" value="50" min="1" max="200"></label>
        </div>
        <button class="button" onclick="getTaskDetail()">æŸ¥è©¢ä»»å‹™è©³æƒ…</button>
        <div id="taskDetailResult" class="result" style="display:none;"></div>
    </div>
    
    <!-- API æ–‡æª”é€£çµ -->
    <div class="container">
        <h2>ğŸ“š API æ–‡æª”</h2>
        <p>å®Œæ•´çš„ API æ–‡æª”è«‹è¨ªå•: <a href="/docs" target="_blank">FastAPI è‡ªå‹•æ–‡æª”</a></p>
        <p>API ç«¯é»åˆ—è¡¨ï¼š</p>
        <ul>
            <li><code>GET /api/v1/database/stats</code> - è³‡æ–™åº«çµ±è¨ˆè³‡è¨Š</li>
            <li><code>GET /api/v1/database/tasks</code> - åˆ†æä»»å‹™è¡¨æŸ¥è©¢</li>
            <li><code>GET /api/v1/database/detection-results</code> - æª¢æ¸¬çµæœè¡¨æŸ¥è©¢</li>
            <li><code>GET /api/v1/database/tasks/{task_id}</code> - ç‰¹å®šä»»å‹™è©³æƒ…</li>
        </ul>
    </div>

    <script>
        const API_BASE = '';
        
        async function apiCall(url, resultElementId) {
            const resultElement = document.getElementById(resultElementId);
            resultElement.style.display = 'block';
            resultElement.textContent = 'â³ è¼‰å…¥ä¸­...';
            resultElement.className = 'result loading';
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    resultElement.textContent = JSON.stringify(data, null, 2);
                    resultElement.className = 'result success';
                } else {
                    resultElement.textContent = `éŒ¯èª¤ ${response.status}: ${JSON.stringify(data, null, 2)}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `ç¶²è·¯éŒ¯èª¤: ${error.message}`;
                resultElement.className = 'result error';
            }
        }
        
        function getStats() {
            apiCall(`${API_BASE}/api/v1/database/stats`, 'statsResult');
        }
        
        function getTasks() {
            const limit = document.getElementById('taskLimit').value;
            const offset = document.getElementById('taskOffset').value;
            const taskType = document.getElementById('taskType').value;
            const status = document.getElementById('taskStatus').value;
            
            let url = `${API_BASE}/api/v1/database/tasks?limit=${limit}&offset=${offset}`;
            if (taskType) url += `&task_type=${taskType}`;
            if (status) url += `&status=${status}`;
            
            apiCall(url, 'tasksResult');
        }
        
        function getDetections() {
            const limit = document.getElementById('detectionLimit').value;
            const offset = document.getElementById('detectionOffset').value;
            const taskId = document.getElementById('detectionTaskId').value;
            const objectType = document.getElementById('detectionObjectType').value;
            const minConf = document.getElementById('detectionMinConf').value;
            
            let url = `${API_BASE}/api/v1/database/detection-results?limit=${limit}&offset=${offset}`;
            if (taskId) url += `&task_id=${taskId}`;
            if (objectType) url += `&object_type=${objectType}`;
            if (minConf) url += `&min_confidence=${minConf}`;
            
            apiCall(url, 'detectionsResult');
        }
        
        function getTaskDetail() {
            const taskId = document.getElementById('taskDetailId').value;
            const includeDetections = document.getElementById('includeDetections').checked;
            const detectionLimit = document.getElementById('detectionDetailLimit').value;
            
            if (!taskId) {
                alert('è«‹è¼¸å…¥ä»»å‹™ID');
                return;
            }
            
            let url = `${API_BASE}/api/v1/database/tasks/${taskId}?include_detections=${includeDetections}&detection_limit=${detectionLimit}`;
            
            apiCall(url, 'taskDetailResult');
        }
    </script>
</body>
</html>
