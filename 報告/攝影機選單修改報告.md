# 攝影機選單修改報告

## 📋 修改概述

成功將攝影機配置中的選擇攝影機下拉選單從模擬資料更改為真實的設備列表。

## 🔧 修改內容

### 1. 組件匯入修改

**檔案**: `react web/src/components/DetectionAnalysis.tsx`

**修改前**:
```tsx
import { useVideoUpload, VideoUploadResponse, useYoloModelList, YoloModelFileInfo, useToggleModelStatus, useActiveModels } from "../hooks/react-query-hooks";
```

**修改後**:
```tsx
import { useVideoUpload, VideoUploadResponse, useYoloModelList, YoloModelFileInfo, useToggleModelStatus, useActiveModels, useCameras } from "../hooks/react-query-hooks";
```

### 2. 新增攝影機資料Hook

**新增程式碼**:
```tsx
// 取得攝影機列表
const { data: cameras, isLoading: isCamerasLoading, isError: isCamerasError } = useCameras();
console.log("cameras hook 初始化成功", { cameras, isCamerasLoading, isCamerasError });
```

### 3. 攝影機選單模板修改

**修改前** (模擬資料):
```tsx
<div>
  <Label htmlFor="camera-select">選擇攝影機</Label>
  <Select>
    <SelectTrigger>
      <SelectValue placeholder="選擇要分析的攝影機" />
    </SelectTrigger>
    <SelectContent>
      <SelectItem value="cam_001">大門入口</SelectItem>
      <SelectItem value="cam_002">停車場</SelectItem>
      <SelectItem value="cam_004">走廊A</SelectItem>
    </SelectContent>
  </Select>
</div>
```

**修改後** (真實資料):
```tsx
<div>
  <Label htmlFor="camera-select">選擇攝影機</Label>
  <Select>
    <SelectTrigger>
      <SelectValue placeholder={isCamerasLoading ? "載入攝影機列表中..." : "選擇要分析的攝影機"} />
    </SelectTrigger>
    <SelectContent>
      {isCamerasLoading ? (
        <SelectItem value="" disabled>載入中...</SelectItem>
      ) : isCamerasError ? (
        <SelectItem value="" disabled>載入攝影機列表失敗</SelectItem>
      ) : cameras && cameras.length > 0 ? (
        cameras.map((camera) => (
          <SelectItem key={camera.id} value={camera.id.toString()}>
            {camera.name} ({camera.status})
          </SelectItem>
        ))
      ) : (
        <SelectItem value="" disabled>
          沒有可用的攝影機
        </SelectItem>
      )}
    </SelectContent>
  </Select>
</div>
```

## ✅ 功能改進

### 1. 動態資料載入
- ✅ 從後端 API `/api/v1/frontend/cameras` 獲取真實攝影機列表
- ✅ 自動載入所有已註冊的攝影機設備

### 2. 載入狀態處理
- ✅ 載入中狀態顯示
- ✅ 錯誤狀態處理
- ✅ 空資料狀態處理

### 3. 攝影機資訊顯示
- ✅ 顯示攝影機名稱和狀態
- ✅ 使用攝影機 ID 作為選項值
- ✅ 狀態指示 (active/inactive/online/offline)

## 🔍 測試驗證

### API 測試
```bash
# 攝影機列表 API 測試
Invoke-RestMethod -Uri "http://localhost:8001/api/v1/frontend/cameras" -Method GET

# 回應範例:
{
  "id": 68,
  "name": "攝影機 0", 
  "status": "inactive",
  "camera_type": "USB",
  "resolution": "640x480",
  "fps": 30,
  "group_id": null
}
```

### 前端測試
- ✅ 建立測試頁面: `http://localhost:8001/website/test_camera_selection.html`
- ✅ 驗證 API 整合正常
- ✅ 確認選單正確顯示真實攝影機資料

## 📱 使用者體驗改進

### 修改前
- ❌ 固定的模擬攝影機選項
- ❌ 與實際設備不符
- ❌ 無法反映真實系統狀態

### 修改後  
- ✅ 即時載入真實攝影機設備
- ✅ 顯示攝影機實際狀態
- ✅ 與設備列表同步
- ✅ 提供載入和錯誤狀態反饋

## 🎯 後續建議

1. **狀態顏色指示**: 可考慮為不同攝影機狀態添加顏色指示
2. **攝影機詳細資訊**: 可在選項中加入解析度、類型等資訊
3. **自動刷新**: 考慮加入定期刷新攝影機狀態的機制
4. **離線攝影機處理**: 可以將離線攝影機顯示為不可選擇狀態

## 🎉 總結

成功將攝影機配置選單從模擬資料升級為真實設備列表，提升了系統的實用性和準確性。使用者現在可以看到真實的攝影機設備並根據實際狀態進行選擇配置。