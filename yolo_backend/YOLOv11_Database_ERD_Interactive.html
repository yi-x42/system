<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOLOv11 資料庫 ERD - 互動式視覺化</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .btn.active {
            background: #4c51bf;
        }
        
        .content {
            padding: 30px;
        }
        
        .diagram-container {
            text-align: center;
            margin: 20px 0;
            min-height: 600px;
        }
        
        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .info-card h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
        }
        
        .info-card ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .info-card li {
            margin: 8px 0;
            color: #4a5568;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        #mermaid-diagram {
            max-width: 100%;
            overflow-x: auto;
        }
        
        .legend {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .legend h4 {
            margin: 0 0 10px 0;
            color: #234e52;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
        }
        
        .core-table { background: #4299e1; }
        .system-table { background: #48bb78; }
        .relation { background: #ed8936; }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .content { padding: 15px; }
            .info-panel { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 YOLOv11 數位雙生分析系統</h1>
            <p>資料庫實體關係圖 (ERD) - 互動式視覺化</p>
        </div>
        
        <div class="controls">
            <button class="btn active" onclick="showDiagram('full')">完整 ERD</button>
            <button class="btn" onclick="showDiagram('core')">核心表結構</button>
            <button class="btn" onclick="showDiagram('system')">系統管理表</button>
            <button class="btn" onclick="showInfo()">結構說明</button>
        </div>
        
        <div class="content">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number">9</div>
                    <div class="stat-label">資料表總數</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">3</div>
                    <div class="stat-label">核心業務表</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">6</div>
                    <div class="stat-label">系統管理表</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">15+</div>
                    <div class="stat-label">關聯關係</div>
                </div>
            </div>
            
            <div class="legend">
                <h4>🎨 圖例說明</h4>
                <div class="legend-item">
                    <div class="legend-color core-table"></div>
                    <span>核心業務表 (分析記錄、檢測結果、行為事件)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color system-table"></div>
                    <span>系統管理表 (使用者、攝影機、模型、配置)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color relation"></div>
                    <span>關聯關係 (一對多、多對一)</span>
                </div>
            </div>
            
            <div class="diagram-container">
                <div id="mermaid-diagram"></div>
            </div>
            
            <div id="info-content" style="display: none;">
                <div class="info-panel">
                    <div class="info-card">
                        <h3>🎯 核心業務流程</h3>
                        <ul>
                            <li>使用者上傳影片或連接攝影機</li>
                            <li>選擇 YOLO 模型進行分析</li>
                            <li>系統建立分析記錄追蹤進度</li>
                            <li>逐幀檢測並記錄物件資訊</li>
                            <li>識別行為事件並分級處理</li>
                            <li>生成分析報告和可視化結果</li>
                        </ul>
                    </div>
                    
                    <div class="info-card">
                        <h3>📊 資料量估算</h3>
                        <ul>
                            <li><strong>小型部署</strong>: 1-2 攝影機，日處理 2-5 影片</li>
                            <li><strong>中型部署</strong>: 5-10 攝影機，日處理 20-50 影片</li>
                            <li><strong>大型部署</strong>: 20+ 攝影機，日處理 100+ 影片</li>
                            <li><strong>檢測結果</strong>: 每分鐘影片約 1800 條記錄</li>
                            <li><strong>行為事件</strong>: 每小時影片約 10-50 條事件</li>
                        </ul>
                    </div>
                    
                    <div class="info-card">
                        <h3>🔧 系統特色</h3>
                        <ul>
                            <li><strong>模組化設計</strong>: 核心功能與擴展功能分離</li>
                            <li><strong>可擴展性</strong>: 支援多攝影機和多模型</li>
                            <li><strong>實時監控</strong>: 分析進度和系統狀態追蹤</li>
                            <li><strong>完整審計</strong>: 所有操作都有日誌記錄</li>
                            <li><strong>權限控制</strong>: 多角色使用者管理</li>
                        </ul>
                    </div>
                    
                    <div class="info-card">
                        <h3>⚡ 性能優化</h3>
                        <ul>
                            <li><strong>索引策略</strong>: 主要查詢欄位建立索引</li>
                            <li><strong>資料分割</strong>: 大表按時間分割</li>
                            <li><strong>批量處理</strong>: 檢測結果批量插入</li>
                            <li><strong>快取機制</strong>: 常用查詢結果快取</li>
                            <li><strong>歸檔策略</strong>: 定期清理歷史資料</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2d3748',
                primaryBorderColor: '#4c51bf',
                lineColor: '#718096',
                secondaryColor: '#ed8936',
                tertiaryColor: '#48bb78'
            }
        });

        const diagrams = {
            full: `
                erDiagram
                    ANALYSIS_RECORDS {
                        uuid id PK
                        varchar camera_id
                        varchar video_path
                        varchar status
                        timestamp created_at
                        timestamp updated_at
                        integer total_frames
                        integer processed_frames
                        json metadata
                    }
                    
                    DETECTION_RESULTS {
                        uuid id PK
                        uuid analysis_id FK
                        integer frame_number
                        varchar object_class
                        float confidence
                        float x_min
                        float y_min
                        float x_max
                        float y_max
                        timestamp detected_at
                    }
                    
                    BEHAVIOR_EVENTS {
                        uuid id PK
                        uuid analysis_id FK
                        varchar event_type
                        varchar severity
                        text description
                        integer start_frame
                        integer end_frame
                        timestamp event_time
                    }
                    
                    USERS {
                        uuid id PK
                        varchar username UK
                        varchar email UK
                        varchar role
                        boolean is_active
                        timestamp created_at
                    }
                    
                    CAMERAS {
                        varchar id PK
                        varchar name
                        varchar type
                        varchar connection_string
                        varchar status
                        uuid created_by FK
                    }
                    
                    YOLO_MODELS {
                        uuid id PK
                        varchar name
                        varchar version
                        varchar file_path
                        varchar model_type
                        boolean is_active
                        uuid created_by FK
                    }
                    
                    ANALYSIS_RECORDS ||--o{ DETECTION_RESULTS : contains
                    ANALYSIS_RECORDS ||--o{ BEHAVIOR_EVENTS : generates
                    USERS ||--o{ ANALYSIS_RECORDS : creates
                    USERS ||--o{ CAMERAS : manages
                    USERS ||--o{ YOLO_MODELS : uploads
                    ANALYSIS_RECORDS }o--|| CAMERAS : uses
                    ANALYSIS_RECORDS }o--|| YOLO_MODELS : processed_by
            `,
            
            core: `
                erDiagram
                    ANALYSIS_RECORDS {
                        uuid id PK
                        varchar camera_id
                        varchar video_path
                        varchar status
                        timestamp created_at
                        integer total_frames
                        integer processed_frames
                    }
                    
                    DETECTION_RESULTS {
                        uuid id PK
                        uuid analysis_id FK
                        integer frame_number
                        varchar object_class
                        float confidence
                        float x_min
                        float y_min
                        float x_max
                        float y_max
                    }
                    
                    BEHAVIOR_EVENTS {
                        uuid id PK
                        uuid analysis_id FK
                        varchar event_type
                        varchar severity
                        text description
                        timestamp event_time
                    }
                    
                    ANALYSIS_RECORDS ||--o{ DETECTION_RESULTS : contains
                    ANALYSIS_RECORDS ||--o{ BEHAVIOR_EVENTS : generates
            `,
            
            system: `
                erDiagram
                    USERS {
                        uuid id PK
                        varchar username UK
                        varchar email UK
                        varchar role
                        boolean is_active
                        timestamp created_at
                    }
                    
                    CAMERAS {
                        varchar id PK
                        varchar name
                        varchar type
                        varchar connection_string
                        varchar status
                        uuid created_by FK
                    }
                    
                    YOLO_MODELS {
                        uuid id PK
                        varchar name
                        varchar version
                        varchar file_path
                        varchar model_type
                        boolean is_active
                        uuid created_by FK
                    }
                    
                    SYSTEM_CONFIGURATIONS {
                        varchar key PK
                        varchar category
                        text value
                        uuid updated_by FK
                    }
                    
                    SYSTEM_LOGS {
                        uuid id PK
                        varchar level
                        varchar component
                        text message
                        timestamp created_at
                        uuid user_id FK
                    }
                    
                    FILE_UPLOADS {
                        uuid id PK
                        varchar original_name
                        varchar file_path
                        varchar upload_type
                        timestamp created_at
                        uuid uploaded_by FK
                    }
                    
                    USERS ||--o{ CAMERAS : manages
                    USERS ||--o{ YOLO_MODELS : uploads
                    USERS ||--o{ SYSTEM_CONFIGURATIONS : configures
                    USERS ||--o{ SYSTEM_LOGS : logs
                    USERS ||--o{ FILE_UPLOADS : uploads
            `
        };

        function showDiagram(type) {
            // 更新按鈕狀態
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 隱藏說明內容
            document.getElementById('info-content').style.display = 'none';
            document.getElementById('mermaid-diagram').style.display = 'block';
            
            // 渲染圖表
            const diagramDiv = document.getElementById('mermaid-diagram');
            diagramDiv.innerHTML = '';
            
            mermaid.render('diagram-' + type, diagrams[type]).then(result => {
                diagramDiv.innerHTML = result.svg;
            });
        }
        
        function showInfo() {
            // 更新按鈕狀態
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 顯示說明內容
            document.getElementById('mermaid-diagram').style.display = 'none';
            document.getElementById('info-content').style.display = 'block';
        }

        // 預設顯示完整 ERD
        window.addEventListener('load', function() {
            showDiagram('full');
        });
    </script>
</body>
</html>